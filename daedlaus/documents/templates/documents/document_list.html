{% extends "base.html" %}
{% load static %}

{% block title %}Documents | Daedalus{% endblock %}

{% block page_title %}Documents{% endblock %}

{% block breadcrumbs %}
<li>Documents</li>
{% endblock %}

{% block content %}
<div class="p-0 md:p-4">
  <!-- Header with Actions -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-800">Documents</h1>
      <p class="text-sm text-gray-600">Manage all case-related documents</p>
    </div>
    <div class="flex gap-2">
      <div class="dropdown dropdown-end">
        <label tabindex="0" class="btn btn-outline btn-sm">
          <i class="fas fa-filter mr-2"></i> Filter
        </label>
        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
          <li><a>All Documents</a></li>
          <li><a>Recent Uploads</a></li>
          <li><a>Shared with Me</a></li>
          <li><a>Archived</a></li>
        </ul>
      </div>
      {% if perms.documents.add_document %}
      <a href="{% url 'documents:document_upload' %}" class="btn btn-primary btn-sm">
        <i class="fas fa-upload mr-2"></i> Upload
      </a>
      {% endif %}
    </div>
  </div>

  <!-- Search Bar -->
  <div class="form-control mb-6">
    <div class="input-group">
      <input type="text" placeholder="Search documents by name, category, or content..." class="input input-bordered w-full" />
      <button class="btn btn-square">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </div>

  <!-- Quick Access Section -->
  <div class="mb-8">
    <h2 class="text-lg font-semibold mb-4">Quick Access</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-primary">
          <i class="fas fa-clock text-3xl"></i>
        </div>
        <div class="stat-title">Recent</div>
        <div class="stat-value text-primary text-2xl">{{ recent_count|default:"0" }}</div>
      </div>
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-secondary">
          <i class="fas fa-star text-3xl"></i>
        </div>
        <div class="stat-title">Favorites</div>
        <div class="stat-value text-secondary text-2xl">{{ favorites_count|default:"0" }}</div>
      </div>
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-accent">
          <i class="fas fa-share-alt text-3xl"></i>
        </div>
        <div class="stat-title">Shared</div>
        <div class="stat-value text-accent text-2xl">{{ shared_count|default:"0" }}</div>
      </div>
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-info">
          <i class="fas fa-pen-to-square text-3xl"></i>
        </div>
        <div class="stat-title">Drafts</div>
        <div class="stat-value text-info text-2xl">{{ draft_count|default:"0" }}</div>
      </div>
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-warning">
          <i class="fas fa-archive text-3xl"></i>
        </div>
        <div class="stat-title">Archived</div>
        <div class="stat-value text-warning text-2xl">{{ archived_count|default:"0" }}</div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs mb-4">
    <a class="tab tab-bordered tab-active">All Documents</a>
    <a class="tab tab-bordered">Case Files</a>
    <a class="tab tab-bordered">Templates</a>
    <a class="tab tab-bordered">Signed Documents</a>
  </div>

  <!-- Documents Table -->
  <div class="overflow-x-auto bg-base-100 shadow rounded-lg">
    {% if documents %}
    <table class="table table-zebra w-full">
      <!-- head -->
      <thead>
        <tr>
          <th>
            <label>
              <input type="checkbox" class="checkbox" />
            </label>
          </th>
          <th>Name</th>
          <th>Category</th>
          <th>Type</th>
          <th>Uploaded</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for document in documents %}
        <tr>
          <th>
            <label>
              <input type="checkbox" class="checkbox" />
            </label>
          </th>
          <td>
            <div class="flex items-center space-x-3">
              <div class="avatar">
                <div class="mask mask-squircle w-10 h-10 bg-blue-100 flex items-center justify-center">
                  <i class="fas fa-file-pdf text-blue-500"></i>
                </div>
              </div>
              <div>
                <div class="font-bold">{{ document.title }}</div>
                <div class="text-sm opacity-50">{{ document.current_version.file_size|filesizeformat|default:"—" }}</div>
              </div>
            </div>
          </td>
          <td>{{ document.category.name|default:"—" }}</td>
          <td>{{ document.file_type|default:"Document" }}</td>
          <td>{{ document.created_at|date:"M d, Y" }}</td>
          <td>
            <span class="badge 
              {% if document.status == 'draft' %}badge-warning{% endif %}
              {% if document.status == 'under_review' %}badge-info{% endif %}
              {% if document.status == 'approved' %}badge-success{% endif %}
              {% if document.status == 'archived' %}badge-neutral{% endif %}">
              {{ document.get_status_display }}
            </span>
          </td>
          <td>
            <div class="dropdown dropdown-left">
              <label tabindex="0" class="btn btn-ghost btn-xs">
                <i class="fas fa-ellipsis-vertical"></i>
              </label>
              <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                <li>
                  <a href="{% url 'documents:document_detail' document.uuid %}">
                    <i class="fas fa-eye mr-2"></i>View
                  </a>
                </li>
                {% if document.current_version %}
                <li>
                  <a href="{% url 'documents:document_download' document.uuid %}">
                    <i class="fas fa-download mr-2"></i>Download
                  </a>
                </li>
                {% endif %}
                <li>
                  <a>
                    <i class="fas fa-share mr-2"></i>Share
                  </a>
                </li>
              </ul>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    
    <!-- Pagination -->
    {% if documents.has_other_pages %}
    <div class="flex justify-between items-center px-6 py-4">
      <div class="text-sm text-gray-600">
        Showing {{ documents.start_index }}-{{ documents.end_index }} of {{ documents.paginator.count }} documents
      </div>
      <div class="btn-group">
        {% if documents.has_previous %}
        <a href="?page={{ documents.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="btn btn-sm">
          «
        </a>
        {% else %}
        <button class="btn btn-sm btn-disabled">«</button>
        {% endif %}
        
        {% for num in documents.paginator.page_range %}
          {% if documents.number == num %}
          <button class="btn btn-sm btn-active">{{ num }}</button>
          {% else %}
          <a href="?page={{ num }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="btn btn-sm">{{ num }}</a>
          {% endif %}
        {% endfor %}
        
        {% if documents.has_next %}
        <a href="?page={{ documents.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="btn btn-sm">
          »
        </a>
        {% else %}
        <button class="btn btn-sm btn-disabled">»</button>
        {% endif %}
      </div>
    </div>
    {% endif %}
    {% else %}
    <div class="p-12 text-center">
      <div class="mb-6">
        <i class="fas fa-file text-gray-400 text-6xl"></i>
      </div>
      <h3 class="text-xl font-bold text-gray-700 mb-1">No documents found</h3>
      <p class="text-gray-500 mb-6">Get started by uploading your first document</p>
      
      {% if perms.documents.add_document %}
      <a href="{% url 'documents:document_upload' %}" class="btn btn-primary">
        <i class="fas fa-upload mr-2"></i>
        Upload Document
      </a>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}