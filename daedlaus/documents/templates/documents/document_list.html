{% extends "base.html" %}
{% load static %}

{% block title %}Documents | Daedalus{% endblock %}

{% block page_title %}Documents{% endblock %}

{% block breadcrumbs %}
<li>Documents</li>
{% endblock %}

{% block extra_css %}
<style>
  .document-card:hover {
    transform: translateY(-2px);
    transition: transform 0.2s ease;
  }
</style>
{% endblock %}

{% block content %}
<div class="p-0 md:p-4">
  <!-- Header with Actions -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-800">Documents</h1>
      <p class="text-sm text-gray-600">Manage all case-related documents</p>
    </div>
    <div class="flex gap-2">
      <div class="dropdown dropdown-end">
        <label tabindex="0" class="btn btn-outline btn-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
          </svg> Filter
        </label>
        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
          <li><a>All Documents</a></li>
          <li><a>Recent Uploads</a></li>
          <li><a>Shared with Me</a></li>
          <li><a>Archived</a></li>
        </ul>
      </div>
      {% if perms.documents.add_document %}
      <a href="{% url 'documents:document_upload' %}" class="btn btn-primary btn-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
        </svg> Upload
      </a>
      {% endif %}
    </div>
  </div>

  <!-- Search Bar -->
  <div class="form-control mb-6">
    <div class="input-group">
      <input type="text" placeholder="Search documents by name, category, or content..." class="input input-bordered w-full" />
      <button class="btn btn-square">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Quick Access Section -->
  <div class="mb-8">
    <h2 class="text-lg font-semibold mb-4">Quick Access</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-primary">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="stat-title">Recent</div>
        <div class="stat-value text-primary text-2xl">{{ recent_count|default:"0" }}</div>
      </div>
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
          </svg>
        </div>
        <div class="stat-title">Favorites</div>
        <div class="stat-value text-secondary text-2xl">{{ favorites_count|default:"0" }}</div>
      </div>
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-accent">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
          </svg>
        </div>
        <div class="stat-title">Shared</div>
        <div class="stat-value text-accent text-2xl">{{ shared_count|default:"0" }}</div>
      </div>
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-info">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
        </div>
        <div class="stat-title">Drafts</div>
        <div class="stat-value text-info text-2xl">{{ draft_count|default:"0" }}</div>
      </div>
      <div class="stat bg-base-100 shadow rounded-lg p-4">
        <div class="stat-figure text-warning">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
          </svg>
        </div>
        <div class="stat-title">Archived</div>
        <div class="stat-value text-warning text-2xl">{{ archived_count|default:"0" }}</div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs mb-4">
    <a class="tab tab-bordered tab-active">All Documents</a>
    <a class="tab tab-bordered">Case Files</a>
    <a class="tab tab-bordered">Templates</a>
    <a class="tab tab-bordered">Signed Documents</a>
  </div>

  <!-- Documents Table -->
  <div class="overflow-x-auto bg-base-100 shadow rounded-lg">
    {% if documents %}
    <table class="table table-zebra w-full">
      <!-- head -->
      <thead>
        <tr>
          <th>
            <label>
              <input type="checkbox" class="checkbox" />
            </label>
          </th>
          <th>Name</th>
          <th>Category</th>
          <th>Type</th>
          <th>Uploaded</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for document in documents %}
        <tr>
          <th>
            <label>
              <input type="checkbox" class="checkbox" />
            </label>
          </th>
          <td>
            <div class="flex items-center space-x-3">
              <div class="avatar">
                <div class="mask mask-squircle w-10 h-10 bg-blue-100 flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                  </svg>
                </div>
              </div>
              <div>
                <div class="font-bold">{{ document.title }}</div>
                <div class="text-sm opacity-50">{{ document.current_version.file_size|filesizeformat|default:"—" }}</div>
              </div>
            </div>
          </td>
          <td>{{ document.category.name|default:"—" }}</td>
          <td>{{ document.file_type|default:"Document" }}</td>
          <td>{{ document.created_at|date:"M d, Y" }}</td>
          <td>
            <span class="badge 
              {% if document.status == 'draft' %}badge-warning{% endif %}
              {% if document.status == 'under_review' %}badge-info{% endif %}
              {% if document.status == 'approved' %}badge-success{% endif %}
              {% if document.status == 'archived' %}badge-neutral{% endif %}">
              {{ document.get_status_display }}
            </span>
          </td>
          <td>
            <div class="dropdown dropdown-left">
              <label tabindex="0" class="btn btn-ghost btn-xs">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                </svg>
              </label>
              <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                <li>
                  <a href="{% url 'documents:document_detail' document.uuid %}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    View
                  </a>
                </li>
                {% if document.current_version %}
                <li>
                  <a href="{% url 'documents:document_download' document.uuid %}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Download
                  </a>
                </li>
                {% endif %}
                <li>
                  <a>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                    </svg>
                    Share
                  </a>
                </li>
              </ul>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    
    <!-- Pagination -->
    {% if documents.has_other_pages %}
    <div class="flex justify-between items-center px-6 py-4">
      <div class="text-sm text-gray-600">
        Showing {{ documents.start_index }}-{{ documents.end_index }} of {{ documents.paginator.count }} documents
      </div>
      <div class="btn-group">
        {% if documents.has_previous %}
        <a href="?page={{ documents.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="btn btn-sm">
          «
        </a>
        {% else %}
        <button class="btn btn-sm btn-disabled">«</button>
        {% endif %}
        
        {% for num in documents.paginator.page_range %}
          {% if documents.number == num %}
          <button class="btn btn-sm btn-active">{{ num }}</button>
          {% else %}
          <a href="?page={{ num }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="btn btn-sm">{{ num }}</a>
          {% endif %}
        {% endfor %}
        
        {% if documents.has_next %}
        <a href="?page={{ documents.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="btn btn-sm">
          »
        </a>
        {% else %}
        <button class="btn btn-sm btn-disabled">»</button>
        {% endif %}
      </div>
    </div>
    {% endif %}
    {% else %}
    <div class="p-12 text-center">
      <div class="mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      </div>
      <h3 class="text-xl font-bold text-gray-700 mb-1">No documents found</h3>
      <p class="text-gray-500 mb-6">Get started by uploading your first document</p>
      
      {% if perms.documents.add_document %}
      <a href="{% url 'documents:document_upload' %}" class="btn btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Upload Document
      </a>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}